---
import { jobPositionQueries } from '../lib/database.js';

// Obtener solo los últimos 3 puestos activos
const activePositions = jobPositionQueries.getActive.all()
  .slice(0, 3)
  .map((position: any) => ({
    ...position,
    requirements: position.requirements ? JSON.parse(position.requirements) : [],
    responsibilities: position.responsibilities ? JSON.parse(position.responsibilities) : []
  }));

// Función para obtener el icono según el departamento
function getDepartmentIcon(department: string): string {
  switch (department?.toLowerCase()) {
    case 'desarrollo':
    case 'tecnología':
    case 'it':
      return 'fas fa-code';
    case 'diseño':
    case 'ux':
    case 'ui':
      return 'fas fa-paint-brush';
    case 'recursos humanos':
    case 'rrhh':
    case 'hr':
      return 'fas fa-users';
    case 'marketing':
      return 'fas fa-bullhorn';
    case 'ventas':
      return 'fas fa-handshake';
    default:
      return 'fas fa-briefcase';
  }
}

// Función para obtener el color según el departamento
function getDepartmentColor(department: string): string {
  switch (department?.toLowerCase()) {
    case 'desarrollo':
    case 'tecnología':
    case 'it':
      return 'from-[#035AA6] to-[#07598C]'; // Azul principal de EMMA
    case 'diseño':
    case 'ux':
    case 'ui':
      return 'from-[#07598C] to-[#11B4D9]'; // Degradado azul medio a claro
    case 'recursos humanos':
    case 'rrhh':
    case 'hr':
      return 'from-[#038C7F] to-[#11B4D9]'; // Verde teal a azul claro
    case 'marketing':
      return 'from-[#11B4D9] to-[#038C7F]'; // Azul claro a verde teal
    case 'ventas':
      return 'from-[#035AA6] to-[#038C7F]'; // Azul principal a verde teal
    default:
      return 'from-[#0D0D0D] to-[#035AA6]'; // Negro a azul principal
  }
}
---

<!-- Sección de Trabaja con Nosotros -->
<section class="py-12 bg-gradient-to-br from-gray-900 to-blue-900 text-white">
  <div class="container mx-auto px-6 lg:px-8">
    <div class="text-center mb-12">
      <div class="inline-flex items-center bg-amber-500/20 text-amber-400 px-3 py-1.5 rounded-full text-sm font-medium mb-3">
        <i class="fas fa-rocket mr-2"></i>
        Equipo en Crecimiento
      </div>
      <h2 class="text-3xl font-bold mb-3">Únete a la Revolución de RRHH</h2>
      <p class="text-lg text-gray-300 max-w-2xl mx-auto">
        Estamos buscando talento excepcional para construir el futuro de la gestión de recursos humanos
      </p>
    </div>

    <div class={`grid gap-6 mb-12 ${
      activePositions.length === 1 ? 'max-w-md mx-auto' : 
      activePositions.length === 2 ? 'grid-cols-1 md:grid-cols-2 max-w-4xl mx-auto' : 
      'md:grid-cols-2 lg:grid-cols-3'
    }`}>
      <!-- Posiciones Activas -->
      {activePositions.length > 0 ? (
        activePositions.map((position: any) => (
          <div class="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 hover:bg-white/20 transition-all duration-300 group">
            <div class="flex items-center mb-4">
              <div class={`w-12 h-12 bg-gradient-to-br ${getDepartmentColor(position.department)} rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform`}>
                <i class={`${getDepartmentIcon(position.department)} text-lg text-white`}></i>
              </div>
              <div>
                <h3 class="text-lg font-bold">{position.title}</h3>
                <span class="text-[#11B4D9] text-sm">{position.department} • {position.location}</span>
              </div>
            </div>
            <p class="text-gray-300 mb-3 text-sm line-clamp-2">
              {position.description || 'Únete a nuestro equipo y contribuye al crecimiento de EMMA'}
            </p>
            <div class="flex flex-wrap gap-1.5 mb-4">
              <span class="bg-[#035AA6]/20 text-[#11B4D9] px-2 py-1 rounded-full text-xs">{position.location}</span>
              <span class="bg-[#038C7F]/20 text-[#11B4D9] px-2 py-1 rounded-full text-xs">{position.employment_type}</span>
              {position.is_featured && (
                <span class="bg-[#07598C]/20 text-[#11B4D9] px-2 py-1 rounded-full text-xs">Destacado</span>
              )}
            </div>
            <a href={`/careers?position=${encodeURIComponent(position.title.toLowerCase().replace(/\s+/g, '-'))}`} class="inline-flex items-center text-amber-400 font-semibold hover:text-amber-300 transition-colors text-sm">
              <i class="fas fa-arrow-right mr-2"></i>
              Más información
            </a>
          </div>
        ))
      ) : (
        <!-- Mensaje cuando no hay posiciones activas -->
        <div class="col-span-full text-center py-8">
          <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-3">
            <i class="fas fa-search text-lg text-gray-400"></i>
          </div>
          <h3 class="text-lg font-semibold text-gray-300 mb-2">No hay posiciones activas disponibles</h3>
          <p class="text-gray-400 text-sm">¡Mantente atento! Nuevas oportunidades se publican regularmente.</p>
        </div>
      )}
    </div>

    <!-- CTA para aplicaciones -->
    <div class="text-center">
      <div class="bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl p-6 max-w-3xl mx-auto">
        <div class="flex items-center justify-center mb-4">
          <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-4">
            <i class="fas fa-handshake text-lg text-white"></i>
          </div>
          <div class="text-left">
            <h3 class="text-xl font-bold text-white">¿Unirte a EMMA?</h3>
            <p class="text-amber-100 text-sm">Te notificaremos sobre nuevas oportunidades</p>
          </div>
        </div>
        
        <form id="careers-newsletter-form" class="max-w-md mx-auto mb-4">
          <div class="flex flex-col gap-3 sm:flex-row">
            <input 
              type="email" 
              name="email"
              placeholder="tu@email.com" 
              required
              class="flex-1 px-4 py-3 rounded-lg border-0 bg-white/20 backdrop-blur-sm text-white placeholder-white/60 outline-none focus:bg-white/30 focus:ring-2 focus:ring-white/50 transition-all text-sm"
            />
            <button 
              type="submit"
              class="bg-white text-[#035AA6] px-6 py-3 rounded-lg font-bold text-sm hover:bg-gray-100 transition-colors inline-flex items-center justify-center whitespace-nowrap"
            >
              <i class="fas fa-bell mr-2"></i>
              Notificarme
            </button>
          </div>
        </form>

        <!-- Beneficios compactos -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-amber-100 text-xs">
          <div class="flex items-center justify-center">
            <i class="fas fa-home mr-1"></i>
            <span>Remoto</span>
          </div>
          <div class="flex items-center justify-center">
            <i class="fas fa-chart-line mr-1"></i>
            <span>Equity</span>
          </div>
          <div class="flex items-center justify-center">
            <i class="fas fa-graduation-cap mr-1"></i>
            <span>Crecimiento</span>
          </div>
          <div class="flex items-center justify-center">
            <i class="fas fa-heart mr-1"></i>
            <span>Innovación</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Include the careers newsletter script -->
<script src="/src/scripts/components/careers-newsletter.ts" type="module"></script>
