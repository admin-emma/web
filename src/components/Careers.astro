---
import { jobPositionQueries } from '../lib/database.js';

// Obtener solo los últimos 3 puestos activos
const activePositions = jobPositionQueries.getActive.all()
  .slice(0, 3)
  .map((position: any) => ({
    ...position,
    requirements: position.requirements ? JSON.parse(position.requirements) : [],
    responsibilities: position.responsibilities ? JSON.parse(position.responsibilities) : []
  }));

// Función para obtener el icono según el departamento
function getDepartmentIcon(department: string): string {
  switch (department?.toLowerCase()) {
    case 'desarrollo':
    case 'tecnología':
    case 'it':
      return 'fas fa-code';
    case 'diseño':
    case 'ux':
    case 'ui':
      return 'fas fa-paint-brush';
    case 'recursos humanos':
    case 'rrhh':
    case 'hr':
      return 'fas fa-users';
    case 'marketing':
      return 'fas fa-bullhorn';
    case 'ventas':
      return 'fas fa-handshake';
    default:
      return 'fas fa-briefcase';
  }
}

// Función para obtener el color según el departamento
function getDepartmentColor(department: string): string {
  switch (department?.toLowerCase()) {
    case 'desarrollo':
    case 'tecnología':
    case 'it':
      return 'from-[#035AA6] to-[#07598C]'; // Azul principal de EMMA
    case 'diseño':
    case 'ux':
    case 'ui':
      return 'from-[#07598C] to-[#11B4D9]'; // Degradado azul medio a claro
    case 'recursos humanos':
    case 'rrhh':
    case 'hr':
      return 'from-[#038C7F] to-[#11B4D9]'; // Verde teal a azul claro
    case 'marketing':
      return 'from-[#11B4D9] to-[#038C7F]'; // Azul claro a verde teal
    case 'ventas':
      return 'from-[#035AA6] to-[#038C7F]'; // Azul principal a verde teal
    default:
      return 'from-[#0D0D0D] to-[#035AA6]'; // Negro a azul principal
  }
}
---

<!-- Sección de Trabaja con Nosotros -->
<section class="py-20 bg-gradient-to-br from-gray-900 to-blue-900 text-white">
  <div class="container mx-auto px-6 lg:px-8">
    <div class="text-center mb-16">
      <div class="inline-flex items-center bg-amber-500/20 text-amber-400 px-4 py-2 rounded-full text-sm font-medium mb-4">
        <i class="fas fa-rocket mr-2"></i>
        Equipo en Crecimiento
      </div>
      <h2 class="text-4xl font-bold mb-4">Únete a la Revolución de RRHH</h2>
      <p class="text-xl text-gray-300 max-w-3xl mx-auto">
        Estamos buscando talento excepcional para construir el futuro de la gestión de recursos humanos
      </p>
    </div>

    <div class={`grid gap-8 mb-16 ${
      activePositions.length === 1 ? 'max-w-md mx-auto' : 
      activePositions.length === 2 ? 'grid-cols-1 md:grid-cols-2 max-w-4xl mx-auto' : 
      'md:grid-cols-2 lg:grid-cols-3'
    }`}>
      <!-- Posiciones Activas -->
      {activePositions.length > 0 ? (
        activePositions.map((position: any) => (
          <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/20 hover:bg-white/20 transition-all duration-300 group">
            <div class="flex items-center mb-6">
              <div class={`w-14 h-14 bg-gradient-to-br ${getDepartmentColor(position.department)} rounded-xl flex items-center justify-center mr-4 group-hover:scale-110 transition-transform`}>
                <i class={`${getDepartmentIcon(position.department)} text-xl text-white`}></i>
              </div>
              <div>
                <h3 class="text-xl font-bold">{position.title}</h3>
                <span class="text-[#11B4D9] text-sm">{position.department} • {position.location}</span>
              </div>
            </div>
            <p class="text-gray-300 mb-4">
              {position.description || 'Únete a nuestro equipo y contribuye al crecimiento de EMMA'}
            </p>
            <div class="flex flex-wrap gap-2 mb-6">
              <span class="bg-[#035AA6]/20 text-[#11B4D9] px-3 py-1 rounded-full text-xs">{position.location}</span>
              <span class="bg-[#038C7F]/20 text-[#11B4D9] px-3 py-1 rounded-full text-xs">{position.employment_type}</span>
              {position.is_featured && (
                <span class="bg-[#07598C]/20 text-[#11B4D9] px-3 py-1 rounded-full text-xs">Destacado</span>
              )}
            </div>
            <a href={`/contact?position=${encodeURIComponent(position.title.toLowerCase().replace(/\s+/g, '-'))}`} class="inline-flex items-center text-amber-400 font-semibold hover:text-amber-300 transition-colors">
              <i class="fas fa-arrow-right mr-2"></i>
              Más información
            </a>
          </div>
        ))
      ) : (
        <!-- Mensaje cuando no hay posiciones activas -->
        <div class="col-span-full text-center py-12">
          <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-search text-2xl text-gray-400"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-300 mb-2">No hay posiciones activas disponibles</h3>
          <p class="text-gray-400">¡Mantente atento! Nuevas oportunidades se publican regularmente.</p>
        </div>
      )}
    </div>

    <!-- CTA para aplicaciones -->
    <div class="text-center">
      <div class="bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl p-8 max-w-4xl mx-auto">
        <div class="flex justify-center mb-6">
          <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
            <i class="fas fa-handshake text-2xl text-white"></i>
          </div>
        </div>
        <h3 class="text-2xl font-bold text-white mb-4">¿Interesado en unirte a EMMA?</h3>
        <p class="text-amber-100 mb-6 text-lg">
          Déjanos tu email y te notificaremos sobre nuevas oportunidades que se ajusten a tu perfil
        </p>
        
        <form id="careers-newsletter-form" class="max-w-lg mx-auto mb-6">
          <div class="flex flex-col sm:flex-row gap-4">
            <input 
              type="email" 
              name="email"
              placeholder="tu@email.com" 
              required
              class="flex-1 px-6 py-4 rounded-xl border-0 bg-white/20 backdrop-blur-sm text-white placeholder-white/60 outline-none focus:bg-white/30 focus:ring-2 focus:ring-white/50 transition-all"
            />
            <button 
              type="submit"
              class="bg-white text-[#035AA6] px-8 py-4 rounded-xl font-bold text-lg hover:bg-gray-100 transition-colors inline-flex items-center justify-center min-w-fit"
            >
              <i class="fas fa-bell mr-3"></i>
              Notificarme
            </button>
          </div>
          <p class="text-amber-100/70 text-sm mt-3">Te avisaremos sobre posiciones que coincidan con tu experiencia</p>
        </form>

        <!-- Botón para ver todas las ofertas -->
        <div class="flex justify-center">
          <a 
            href="/careers" 
            class="bg-white/10 backdrop-blur-sm text-white border-2 border-white/30 px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/20 hover:border-white/50 transition-all inline-flex items-center"
          >
            <i class="fas fa-briefcase mr-3"></i>
            Ver Todas las Ofertas
          </a>
        </div>

        <!-- Beneficios -->
        <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4 text-amber-100">
          <div class="flex items-center justify-center">
            <i class="fas fa-home mr-2"></i>
            <span class="text-sm">Trabajo remoto</span>
          </div>
          <div class="flex items-center justify-center">
            <i class="fas fa-chart-line mr-2"></i>
            <span class="text-sm">Equity/Acciones</span>
          </div>
          <div class="flex items-center justify-center">
            <i class="fas fa-graduation-cap mr-2"></i>
            <span class="text-sm">Crecimiento profesional</span>
          </div>
          <div class="flex items-center justify-center">
            <i class="fas fa-heart mr-2"></i>
            <span class="text-sm">Ambiente innovador</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Include the careers newsletter script -->
<script src="/src/scripts/components/careers-newsletter.ts" type="module"></script>
